<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Test - Kapak & Borobudur</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <!-- GANTI CDN AR.js -->
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
        /* [CSS Anda tetap sama - bagus!] */
    </style>
</head>
<body>
    <!-- ========== AR MODE ========== -->
    <div id="ar-mode">
        <div id="instructions">ðŸ“· Scan Barcode 3 (Kapak) atau Barcode 0 (Borobudur)</div>
        <div class="loading" id="loading">Memuat AR...</div>

        <button id="start-vr-btn">ðŸ•Œ MULAI TUR<br>BOROBUDUR</button>

        <!-- Info Panel Kapak -->
        <div id="info-panel-kapak">
            <!-- [konten info panel kapak tetap] -->
        </div>

        <!-- Info Panel Borobudur -->
        <div id="info-panel-borobudur">
            <!-- [konten info panel borobudur tetap] -->
        </div>

        <!-- AR Scene -->
        <a-scene 
            embedded 
            arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;" 
            vr-mode-ui="enabled: false"
            renderer="antialias: true; alpha: true">
            
            <a-camera></a-camera>

            <!-- Marker 3: Kapak Genggam - PERBAIKI PATH -->
            <a-marker type="barcode" value=3 id="marker-kapak">
                <a-image 
                    id="kapak-image"
                    src="https://bbull0444-png.github.io/ar-test/models/kapak-genggam-1.png" 
                    scale="1.5 1.5 1.5" 
                    position="0 0 0" 
                    rotation="-90 0 0"
                    transparent="true"
                    shader="flat"
                    opacity="0.95">
                </a-image>
            </a-marker>

            <!-- Marker 0: Borobudur - PERBAIKI VALUE -->
            <a-marker type="barcode" value=0 id="marker-borobudur">
                <a-text 
                    value="BOROBUDUR\nVR READY" 
                    align="center" 
                    color="#00ffff" 
                    scale="0.5 0.5 0.5"
                    position="0 0.5 0">
                </a-text>
            </a-marker>

        </a-scene>
    </div>

    <!-- ========== VR MODE ========== -->
    <div id="vr-container">
        <!-- PERBAIKI VR SCENE -->
        <a-scene id="vr-scene" embedded vr-mode-ui="enabled: true"
                 renderer="antialias: true; alpha: true"
                 background="color: #000000">
                 
            <!-- Sky 360 - PASTIKAN PATH BENAR -->
            <a-sky id="vr-sky" src="https://bbull0444-png.github.io/ar-test/SvD/Borobudur-1-360.jpg" rotation="0 -130 0"></a-sky>

            <a-entity camera look-controls wasd-controls position="0 1.6 0">
                <a-cursor color="#00ffff"></a-cursor>
            </a-entity>
        </a-scene>

        <!-- [Navigation hotspots dan exit button tetap] -->
    </div>

    <script>
        // ========== INISIALISASI ELEMENTS ==========
        const loading = document.getElementById('loading');
        const instructions = document.getElementById('instructions');
        const arMode = document.getElementById('ar-mode');
        const vrContainer = document.getElementById('vr-container');

        // Kapak elements
        const markerKapak = document.getElementById('marker-kapak');
        const infoPanelKapak = document.getElementById('info-panel-kapak');
        const kapakImage = document.getElementById('kapak-image');
        const prevBtnKapak = document.getElementById('prev-view-kapak');
        const nextBtnKapak = document.getElementById('next-view-kapak');
        const currentViewSpanKapak = document.getElementById('current-view-kapak');

        // Borobudur elements
        const markerBorobudur = document.getElementById('marker-borobudur');
        const infoPanelBorobudur = document.getElementById('info-panel-borobudur');
        const startVRBtn = document.getElementById('start-vr-btn');
        const exitVRBtn = document.getElementById('exit-vr-btn');
        const vrSky = document.getElementById('vr-sky');

        // Hotspots
        const hotspotLeft = document.getElementById('hotspot-left');
        const hotspotRight = document.getElementById('hotspot-right');
        const hotspotForward = document.getElementById('hotspot-forward');
        const hotspotCenter = document.getElementById('hotspot-center');

        // ========== KAPAK GENGGAM ==========
        const kapakViews = [
            'https://bbull0444-png.github.io/ar-test/models/kapak-genggam-1.png',
            'https://bbull0444-png.github.io/ar-test/models/kapak-genggam-2.png',
            'https://bbull0444-png.github.io/ar-test/models/kapak-genggam-3.png'
        ];
        let currentKapakIndex = 0;

        function updateKapakButtons() {
            if (prevBtnKapak && nextBtnKapak) {
                prevBtnKapak.disabled = currentKapakIndex === 0;
                nextBtnKapak.disabled = currentKapakIndex === kapakViews.length - 1;
                currentViewSpanKapak.textContent = currentKapakIndex + 1;
            }
        }

        function changeKapakView(direction) {
            const newIndex = currentKapakIndex + direction;
            if (newIndex >= 0 && newIndex < kapakViews.length) {
                currentKapakIndex = newIndex;
                // PRELOAD gambar sebelum ditampilkan
                const img = new Image();
                img.onload = function() {
                    kapakImage.setAttribute('src', kapakViews[currentKapakIndex]);
                };
                img.src = kapakViews[currentKapakIndex];
                updateKapakButtons();
            }
        }

        // Event listeners untuk Kapak
        if (prevBtnKapak) prevBtnKapak.addEventListener('click', () => changeKapakView(-1));
        if (nextBtnKapak) nextBtnKapak.addEventListener('click', () => changeKapakView(1));

        // ========== BOROBUDUR VR ==========
        const borobudurViews = {
            center: 'https://bbull0444-png.github.io/ar-test/SvD/Borobudur-1-360.jpg',
            left: 'https://bbull0444-png.github.io/ar-test/SvD/Borobudur-2-360.jpg',
            right: 'https://bbull0444-png.github.io/ar-test/SvD/Borobudur-3-360.jpg',
            forward: 'https://bbull0444-png.github.io/ar-test/SvD/Borobudur-4-360.jpg'
        };

        let currentVRView = 'center';

        function updateHotspots() {
            if (currentVRView === 'center') {
                hotspotLeft.style.display = 'block';
                hotspotRight.style.display = 'block';
                hotspotForward.style.display = 'block';
                hotspotCenter.style.display = 'none';
            } else {
                hotspotLeft.style.display = 'none';
                hotspotRight.style.display = 'none';
                hotspotForward.style.display = 'none';
                hotspotCenter.style.display = 'block';
            }
        }

        function changeVRView(view) {
            if (borobudurViews[view]) {
                currentVRView = view;
                // PRELOAD gambar 360
                const img = new Image();
                img.onload = function() {
                    vrSky.setAttribute('src', borobudurViews[view]);
                };
                img.src = borobudurViews[view];
                updateHotspots();
            }
        }

        // ========== EVENT LISTENERS ==========
        if (markerKapak) {
            markerKapak.addEventListener('markerFound', function() {
                console.log('âœ… Marker 3 (Kapak) detected');
                loading.style.display = 'none';
                infoPanelKapak.classList.add('show');
                infoPanelBorobudur.classList.remove('show');
                startVRBtn.classList.remove('show');
                currentKapakIndex = 0;
                kapakImage.setAttribute('src', kapakViews[0]);
                updateKapakButtons();
            });

            markerKapak.addEventListener('markerLost', function() {
                console.log('âŒ Marker 3 lost');
                loading.style.display = 'block';
                loading.textContent = 'Marker hilang, cari Barcode 3 atau 0...';
                infoPanelKapak.classList.remove('show');
            });
        }

        if (markerBorobudur) {
            markerBorobudur.addEventListener('markerFound', function() {
                console.log('âœ… Marker 0 (Borobudur) detected');
                loading.style.display = 'none';
                infoPanelBorobudur.classList.add('show');
                infoPanelKapak.classList.remove('show');
                startVRBtn.classList.add('show');
            });

            markerBorobudur.addEventListener('markerLost', function() {
                console.log('âŒ Marker 0 lost');
                loading.style.display = 'block';
                loading.textContent = 'Marker hilang, cari Barcode 0 atau 3...';
                infoPanelBorobudur.classList.remove('show');
                startVRBtn.classList.remove('show');
            });
        }

        // VR Events
        startVRBtn.addEventListener('click', function() {
            console.log('ðŸš€ Entering VR Mode');
            arMode.style.display = 'none';
            vrContainer.classList.add('active');
            changeVRView('center');
        });

        exitVRBtn.addEventListener('click', function() {
            console.log('ðŸšª Exiting VR Mode');
            vrContainer.classList.remove('active');
            arMode.style.display = 'block';
            loading.style.display = 'block';
            loading.textContent = 'Kembali ke AR Mode...';
        });

        // Hotspot Events
        hotspotLeft.addEventListener('click', () => changeVRView('left'));
        hotspotRight.addEventListener('click', () => changeVRView('right'));
        hotspotForward.addEventListener('click', () => changeVRView('forward'));
        hotspotCenter.addEventListener('click', () => changeVRView('center'));

        // ========== INITIALIZATION ==========
        setTimeout(() => {
            loading.textContent = 'Cari Barcode 3 (Kapak) atau 0 (Borobudur)...';
        }, 2000);

        // Inisialisasi awal
        updateKapakButtons();
        updateHotspots();

        // Error handling untuk gambar
        window.addEventListener('error', function(e) {
            console.error('Error loading resource:', e);
            loading.textContent = 'Error memuat resource, periksa koneksi...';
        });
    </script>
</body>
</html>
